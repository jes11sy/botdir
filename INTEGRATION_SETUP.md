# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ CRM ‚Üî Bot Director

## –û–±–∑–æ—Ä

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–≤–µ–¥–æ–º–ª—è—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞ –≤ Telegram –±–æ—Ç–µ –æ –ø–µ—Ä–µ–Ω–æ—Å–µ –¥–∞—Ç—ã –≤—Å—Ç—Ä–µ—á–∏ –∑–∞–∫–∞–∑–∞ –≤ CRM —Å–∏—Å—Ç–µ–º–µ.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
CRM (Backend) ‚Üí HTTP Request ‚Üí Bot Director (Webhook) ‚Üí Telegram Message
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

#### –í CRM (backend/.env):
```env
# Director Bot Integration
BOT_WEBHOOK_URL="http://localhost:3001"
WEBHOOK_TOKEN="your_webhook_secret_token"
```

#### –í –±–æ—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞ (bot_dir/.env):
```env
# Webhook Settings
WEBHOOK_TOKEN="your_webhook_secret_token"
WEBHOOK_PORT=3001
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

#### –í –±–æ—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞:
```bash
cd bot_dir
npm install express
```

#### –í CRM (—É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω):
```bash
# axios —É–∂–µ –µ—Å—Ç—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö
```

### 3. –ó–∞–ø—É—Å–∫

#### –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞:
```bash
cd bot_dir
npm start
```

–ë–æ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ –ø–æ—Ä—Ç—É 3001 —Å webhook endpoint.

#### –ó–∞–ø—É—Å–∫ CRM:
```bash
cd callcentre_crm/backend
npm run dev
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

#### Health check –±–æ—Ç–∞:
```bash
curl http://localhost:3001/health
```

#### –¢–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:
```bash
curl -X POST http://localhost:3001/webhook/order-update \
  -H "Content-Type: application/json" \
  -d '{
    "orderId": 123,
    "newDate": "2024-12-25T14:30:00Z",
    "city": "–ú–æ—Å–∫–≤–∞",
    "token": "your_webhook_secret_token"
  }'
```

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–í CRM** –æ–ø–µ—Ä–∞—Ç–æ—Ä –∏–∑–º–µ–Ω—è–µ—Ç –¥–∞—Ç—É –≤—Å—Ç—Ä–µ—á–∏ –∑–∞–∫–∞–∑–∞
2. **CRM** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç HTTP-–∑–∞–ø—Ä–æ—Å –±–æ—Ç—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞ —Å –¥–∞–Ω–Ω—ã–º–∏:
   - `orderId` - ID –∑–∞–∫–∞–∑–∞
   - `newDate` - –Ω–æ–≤–∞—è –¥–∞—Ç–∞ –≤—Å—Ç—Ä–µ—á–∏
   - `city` - –≥–æ—Ä–æ–¥ –∑–∞–∫–∞–∑–∞
   - `token` - —Ç–æ–∫–µ–Ω –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
3. **–ë–æ—Ç** –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω –∏ –Ω–∞—Ö–æ–¥–∏—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞ –ø–æ –≥–æ—Ä–æ–¥—É
4. **–ë–æ—Ç** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä—É –≤ Telegram

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

```
üìÖ –ó–∞–∫–∞–∑ ‚Ññ123 –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω –Ω–∞ 25.12.2024 14:30
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–∫–µ–Ω –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –º–µ–∂–¥—É CRM –∏ –±–æ—Ç–æ–º
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:
- –£—Å–ø–µ—à–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –û—à–∏–±–∫–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ
- –ù–µ–≤–µ—Ä–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞ –¥–ª—è –≥–æ—Ä–æ–¥–∞

## Troubleshooting

### –ë–æ—Ç –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 3001
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `BOT_WEBHOOK_URL` –≤ CRM
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ –æ–±–µ–∏—Ö —Å–∏—Å—Ç–µ–º–∞—Ö

### –î–∏—Ä–µ–∫—Ç–æ—Ä –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞ —É–∫–∞–∑–∞–Ω `tg_id` –≤ —Ç–∞–±–ª–∏—Ü–µ `director`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä –∑–∞–ø—É—Å—Ç–∏–ª –±–æ—Ç–∞ –∫–æ–º–∞–Ω–¥–æ–π `/start`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±–æ—Ç–∞ –Ω–∞ –æ—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏

### –û—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω Telegram –±–æ—Ç–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ webhook
